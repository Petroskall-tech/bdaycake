<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laloo Birthday Loader</title>
  <style>
    :root{
      --bg: rgba(255,255,255,0.92);
      --red1:#c4142d;
      --red2:#b11226;
      --shadow: rgba(0,0,0,0.18);
      --glow: rgba(255, 165, 180, 0.55);
    }
    html,body{height:100%; margin:0;}
    body{
      overflow:hidden;
      background: transparent;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .overlay{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: radial-gradient(1200px 700px at 50% 40%, rgba(255,210,220,0.28), transparent 58%), var(--bg);
      backdrop-filter: blur(3px);
      -webkit-backdrop-filter: blur(3px);
      z-index: 999999;
      animation: overlayIn 320ms ease-out both;
    }
    .overlay.exit{
      animation: overlayOut 650ms ease-in forwards;
    }
    @keyframes overlayIn { from{opacity:0} to{opacity:1} }
    @keyframes overlayOut { to{opacity:0; visibility:hidden} }

    #fx{ position:absolute; inset:0; width:100%; height:100%; pointer-events:none; }

    .stage{
      position:relative;
      width:min(560px, 92vw);
      height:min(460px, 78vh);
      display:flex; align-items:center; justify-content:center;
    }
    .floor{
      position:absolute;
      width:min(380px, 72vw);
      height:30px;
      bottom:92px;
      background: radial-gradient(closest-side, rgba(0,0,0,0.22), transparent 70%);
      filter: blur(2px);
      opacity:0;
      transform: translateY(10px);
      animation: floorIn 600ms ease-out 260ms forwards;
    }
    @keyframes floorIn { to{opacity:1; transform: translateY(0)} }

    .boxWrap{
      position:relative;
      width: 210px;
      height: 210px;
      transform: translateY(22px) scale(0.92);
      opacity:0;
      animation: boxIntro 700ms cubic-bezier(.2,.9,.25,1.2) 160ms forwards,
                 boxShake 1600ms ease-in-out 1400ms forwards;
    }
    @keyframes boxIntro {
      from { opacity:0; transform: translateY(34px) scale(0.84); }
      to   { opacity:1; transform: translateY(22px) scale(1); }
    }
    @keyframes boxShake {
      0%{transform:translateY(22px) rotate(0deg)}
      15%{transform:translateY(22px) rotate(-2deg)}
      30%{transform:translateY(22px) rotate(2deg)}
      45%{transform:translateY(22px) rotate(-2.6deg)}
      60%{transform:translateY(22px) rotate(2.6deg)}
      75%{transform:translateY(22px) rotate(-1.2deg)}
      90%{transform:translateY(22px) rotate(1.2deg)}
      100%{transform:translateY(22px) rotate(0deg)}
    }

    .boxBody{
      position:absolute;
      left:50%; bottom:0;
      width:210px; height:150px;
      transform: translateX(-50%);
      background: linear-gradient(180deg, var(--red1), var(--red2));
      border-radius: 18px;
      box-shadow: 0 18px 44px var(--shadow);
      overflow:hidden;
    }
    .boxBody::before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(255,255,255,0.14), transparent 30%, rgba(255,255,255,0.07));
      transform: translateX(-24%);
      opacity:0.75;
    }
    .boxBody::after{
      /* inner glow for realism */
      content:"";
      position:absolute;
      left:50%; bottom:-10px;
      width:260px; height:220px;
      transform: translateX(-50%) translateY(60px) scale(0.9);
      background: radial-gradient(circle at 50% 70%, rgba(255,255,255,0.92), rgba(255,170,190,0.38), transparent 62%);
      opacity:0;
      filter: blur(6px);
      animation: innerGlow 1800ms ease-out 2000ms forwards;
    }
    @keyframes innerGlow{
      0%{ opacity:0; transform: translateX(-50%) translateY(70px) scale(0.9); }
      35%{ opacity:1; transform: translateX(-50%) translateY(15px) scale(1); }
      100%{ opacity:0.35; transform: translateX(-50%) translateY(-10px) scale(1.06); }
    }

    .ribbon{
      position:absolute;
      left:50%; top:0;
      width:22px; height:100%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.25);
      mix-blend-mode: screen;
      opacity:0.75;
    }

    .boxLid{
      position:absolute;
      left:50%; top:22px;
      width:232px; height:60px;
      transform: translateX(-50%) translateY(0) rotate(0deg);
      transform-origin: 50% 90%;
      background: linear-gradient(180deg, #d92b45, var(--red1));
      border-radius: 18px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.14);
      animation: lidPop 1900ms cubic-bezier(.16,.95,.18,1.05) 1750ms forwards;
    }
    @keyframes lidPop {
      0%   { transform: translateX(-50%) translateY(0) rotate(0deg); }
      25%  { transform: translateX(-50%) translateY(-10px) rotate(-6deg); }
      55%  { transform: translateX(-50%) translateY(-36px) rotate(-18deg); }
      100% { transform: translateX(-50%) translateY(-62px) rotate(-30deg); }
    }

    .spark{
      position:absolute;
      left:50%; top:58px;
      width:10px; height:10px;
      transform: translateX(-50%);
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,0.0));
      opacity:0;
      filter: drop-shadow(0 0 22px var(--glow)) drop-shadow(0 0 38px var(--glow));
      animation: sparkBurst 700ms ease-out 2350ms forwards;
    }
    @keyframes sparkBurst{
      0% { opacity:0; transform: translateX(-50%) scale(0.6); }
      40%{ opacity:1; transform: translateX(-50%) scale(3.4); }
      100%{ opacity:0; transform: translateX(-50%) scale(6.0); }
    }

    .item{
      position:absolute;
      left:50%; top:92px;
      transform: translateX(-50%) translateY(44px) scale(0.6) rotate(0deg);
      opacity:0;
      will-change: transform, opacity;
      filter: drop-shadow(0 14px 26px rgba(0,0,0,0.16));
    }
    .bottle{
      width: 96px;
      animation: bottleLaunch 1700ms cubic-bezier(.12,.95,.2,1.05) 2450ms forwards;
    }
    @keyframes bottleLaunch{
      0% { opacity:0; transform: translateX(-50%) translateY(58px) scale(0.65) rotate(0deg); }
      18%{ opacity:1; transform: translateX(-50%) translateY(18px) scale(0.95) rotate(-6deg); }
      60%{ opacity:1; transform: translateX(-50%) translateY(-150px) scale(1.05) rotate(6deg); }
      100%{ opacity:1; transform: translateX(-50%) translateY(-205px) scale(1.0) rotate(0deg); }
    }

    .title{
      position:absolute;
      left:50%;
      bottom: 54px;
      transform: translateX(-50%) translateY(10px);
      text-align:center;
      font-weight: 900;
      letter-spacing: 3px;
      font-size: clamp(18px, 3.8vw, 34px);
      color: #111;
      opacity:0;
      text-transform: uppercase;
      filter: drop-shadow(0 10px 26px rgba(0,0,0,0.10));
      animation: titleIn 900ms ease-out 3600ms forwards,
                 titlePulse 1400ms ease-in-out 5200ms infinite;
      white-space: nowrap;
    }
    .subtitle{
      position:absolute;
      left:50%;
      bottom: 22px;
      transform: translateX(-50%) translateY(10px);
      font-weight: 700;
      opacity:0;
      font-size: clamp(12px, 2.3vw, 16px);
      color: rgba(17,17,17,0.70);
      letter-spacing: 1px;
      animation: subtitleIn 900ms ease-out 3850ms forwards;
      white-space: nowrap;
    }
    @keyframes titleIn{ to { opacity:1; transform: translateX(-50%) translateY(0); } }
    @keyframes subtitleIn{ to { opacity:1; transform: translateX(-50%) translateY(0); } }
    @keyframes titlePulse{
      0%,100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.03); }
    }

    /* Small hint */
    .hint{
      position:absolute;
      top:14px; left:50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: rgba(17,17,17,0.55);
      opacity:0;
      animation: hintIn 600ms ease-out 900ms forwards;
      user-select:none;
    }
    @keyframes hintIn{ to{opacity:1} }

    @media (max-width: 480px){
      .bottle{ width: 84px; }
      .boxWrap{ width:190px; height:190px; }
      .boxBody{ width:190px; }
      .boxLid{ width:212px; }
      .title,.subtitle{ white-space: normal; text-align:center; }
    }
  </style>
</head>
<body>
  <div id="overlay" class="overlay">
    <canvas id="fx"></canvas>

    <div class="stage">
      <div class="hint">Tap anywhere to continue</div>
      <div class="floor"></div>

      <div class="boxWrap">
        <div class="boxLid"></div>
        <div class="boxBody"><div class="ribbon"></div></div>
        <div class="spark"></div>

        <img class="item bottle"
          src="https://assets.laloo.gr/img/cms/bottle.png"
          alt="Laloo Product" />
      </div>

      <div class="title">LALOO BIRTHDAY SALES</div>
      <div class="subtitle">14 years of color</div>
    </div>
  </div>

  <script>
    // ===== SETTINGS =====
    const qs = new URLSearchParams(location.search);
    const duration = Math.max(2000, Math.min(20000, Number(qs.get("duration")) || 10000));

    // Optional redirect fallback if you cannot run JS on the parent:
    // add: ?redirect=1&to=https%3A%2F%2Flaloo.gr
    const redirect = qs.get("redirect") === "1";
    const to = qs.get("to") ? decodeURIComponent(qs.get("to")) : null;

    const overlay = document.getElementById("overlay");
    const EXIT_MS = 650;
    let doneOnce = false;

    function done(reason){
      if (doneOnce) return;
      doneOnce = true;

      // Visual exit inside iframe
      overlay.classList.add("exit");

      // Tell parent (if parent listens) to remove iframe / unblock clicks
      try { window.parent.postMessage({ type: "BIRTHDAY_LOADER_DONE", reason }, "*"); } catch(e){}

      // Fallback: redirect top window (removes iframe problem without parent JS, but reloads page)
      if (redirect && to) {
        setTimeout(() => {
          try { window.top.location.href = to; } catch(e) {}
        }, 50);
      }

      // Remove overlay from inside iframe (not enough alone if iframe stays, but OK)
      setTimeout(() => {
        try { overlay.remove(); } catch(e){}
      }, EXIT_MS + 30);
    }

    // Click anywhere inside the iframe
    window.addEventListener("click", () => done("click"), { capture:true, once:true });

    // Failsafe timeout
    setTimeout(() => done("timeout"), duration);

    // ===== Fireworks particles (lightweight) =====
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d");

    function resize(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    window.addEventListener("resize", resize);
    resize();

    const particles = [];
    const start = performance.now();

    function burst(x,y,power){
      const count = Math.floor(34 + power * 26);
      for(let i=0;i<count;i++){
        const a = Math.random()*Math.PI*2;
        const sp = (1.1 + Math.random()*2.6) * power;
        particles.push({
          x,y,
          vx: Math.cos(a)*sp*120,
          vy: Math.sin(a)*sp*120 - (75*power),
          life: 850 + Math.random()*850,
          born: performance.now(),
          size: 1 + Math.random()*2.1,
          hue: 340 + Math.random()*25,
          sat: 88 + Math.random()*8,
          lum: 62 + Math.random()*14
        });
      }
    }

    const schedule = [
      { t: 2300, n: 1, p: 1.05 },
      { t: 3200, n: 2, p: 0.95 },
      { t: 5200, n: 2, p: 1.0  },
      { t: 7400, n: 2, p: 0.9  },
      { t: 9000, n: 1, p: 0.85 },
    ];
    let schIdx = 0;

    function tick(){
      const t = performance.now() - start;

      while (schIdx < schedule.length && t >= schedule[schIdx].t){
        for(let i=0;i<schedule[schIdx].n;i++){
          const x = window.innerWidth*(0.25 + Math.random()*0.5);
          const y = window.innerHeight*(0.18 + Math.random()*0.25);
          burst(x,y,schedule[schIdx].p);
        }
        schIdx++;
      }

      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        const age = performance.now()-p.born;
        const k = age/p.life;
        if(k>=1){ particles.splice(i,1); continue; }

        const dt = 16/1000;
        p.vy += 520*dt;
        p.x += p.vx*dt;
        p.y += p.vy*dt;

        const alpha = (1-k)*0.9;
        ctx.beginPath();
        ctx.fillStyle = `hsla(${p.hue},${p.sat}%,${p.lum}%,${alpha})`;
        ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
        ctx.fill();
      }

      if (t < duration + 900) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  </script>
</body>
</html>
