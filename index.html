<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laloo Birthday Loader</title>
  <style>
    :root{
      --bg: rgba(255,255,255,0.92);
      --red1:#c4142d;
      --red2:#b11226;
      --shadow: rgba(0,0,0,0.18);
      --glow: rgba(255, 165, 180, 0.55);
      --text:#111;
    }

    html,body{height:100%; margin:0;}
    body{
      overflow:hidden;
      background: transparent;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .overlay{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: radial-gradient(1200px 700px at 50% 40%, rgba(255,210,220,0.28), transparent 58%),
                  var(--bg);
      backdrop-filter: blur(3px);
      -webkit-backdrop-filter: blur(3px);
      z-index: 999999;
      animation: overlayIn 320ms ease-out both;
    }

    /* Fireworks layer */
    #fx {
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
    }

    .stage{
      position:relative;
      width:min(560px, 92vw);
      height:min(460px, 78vh);
      display:flex; align-items:center; justify-content:center;
    }

    .floor{
      position:absolute;
      width:min(380px, 72vw);
      height:30px;
      bottom:92px;
      background: radial-gradient(closest-side, rgba(0,0,0,0.22), transparent 70%);
      filter: blur(2px);
      opacity:0;
      transform: translateY(10px);
      animation: floorIn 600ms ease-out 260ms forwards;
    }

    .boxWrap{
      position:relative;
      width: 210px;
      height: 210px;
      transform: translateY(22px) scale(0.92);
      opacity:0;
      animation: boxIntro 700ms cubic-bezier(.2,.9,.25,1.2) 160ms forwards,
                 boxShake 1600ms ease-in-out 1400ms forwards;
    }

    .boxBody{
      position:absolute;
      left:50%; bottom:0;
      width:210px; height:150px;
      transform: translateX(-50%);
      background: linear-gradient(180deg, var(--red1), var(--red2));
      border-radius: 18px;
      box-shadow: 0 18px 44px var(--shadow);
      overflow:hidden;
    }

    .boxBody::before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(255,255,255,0.14), transparent 30%, rgba(255,255,255,0.07));
      transform: translateX(-24%);
      opacity:0.75;
    }

    .ribbon{
      position:absolute;
      left:50%; top:0;
      width:22px; height:100%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.25);
      mix-blend-mode: screen;
      opacity:0.75;
    }

    /* SLOWER opening */
    .boxLid{
      position:absolute;
      left:50%; top:22px;
      width:232px; height:60px;
      transform: translateX(-50%) translateY(0) rotate(0deg);
      transform-origin: 50% 90%;
      background: linear-gradient(180deg, #d92b45, var(--red1));
      border-radius: 18px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.14);
      animation: lidPop 1900ms cubic-bezier(.16,.95,.18,1.05) 1750ms forwards; /* slower + later */
    }

    .spark{
      position:absolute;
      left:50%; top:58px;
      width:10px; height:10px;
      transform: translateX(-50%);
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,0.0));
      opacity:0;
      filter: drop-shadow(0 0 22px var(--glow)) drop-shadow(0 0 38px var(--glow));
      animation: sparkBurst 700ms ease-out 2350ms forwards; /* slower + later */
    }

    .item{
      position:absolute;
      left:50%; top:92px;
      transform: translateX(-50%) translateY(44px) scale(0.6) rotate(0deg);
      opacity:0;
      will-change: transform, opacity;
      filter: drop-shadow(0 14px 26px rgba(0,0,0,0.16));
    }

    /* Launch after the lid starts opening */
    .bottle{
      width: 96px;
      animation: bottleLaunch 1700ms cubic-bezier(.12,.95,.2,1.05) 2450ms forwards;
    }

    .heart{ width: 58px; }
    .petal{ width: 66px; opacity:0.95; }

    .h1{ animation: floatBurst1 1900ms cubic-bezier(.12,.95,.2,1.05) 2520ms forwards; }
    .h2{ animation: floatBurst2 2000ms cubic-bezier(.12,.95,.2,1.05) 2580ms forwards; }
    .h3{ animation: floatBurst3 2050ms cubic-bezier(.12,.95,.2,1.05) 2640ms forwards; }

    .p1{ animation: petalBurst1 2150ms cubic-bezier(.12,.95,.2,1.05) 2480ms forwards; }
    .p2{ animation: petalBurst2 2250ms cubic-bezier(.12,.95,.2,1.05) 2540ms forwards; }
    .p3{ animation: petalBurst3 2300ms cubic-bezier(.12,.95,.2,1.05) 2600ms forwards; }

    .title{
      position:absolute;
      left:50%;
      bottom: 54px;
      transform: translateX(-50%) translateY(10px);
      text-align:center;
      font-weight: 900;
      letter-spacing: 3px;
      font-size: clamp(18px, 3.8vw, 34px);
      color: #111;
      opacity:0;
      text-transform: uppercase;
      filter: drop-shadow(0 10px 26px rgba(0,0,0,0.10));
      animation: titleIn 900ms ease-out 3600ms forwards,
                 titlePulse 1400ms ease-in-out 5200ms infinite;
      white-space: nowrap;
    }

    .subtitle{
      position:absolute;
      left:50%;
      bottom: 22px;
      transform: translateX(-50%) translateY(10px);
      font-weight: 700;
      opacity:0;
      font-size: clamp(12px, 2.3vw, 16px);
      color: rgba(17,17,17,0.70);
      letter-spacing: 1px;
      animation: subtitleIn 900ms ease-out 3850ms forwards;
      white-space: nowrap;
    }

    .overlay.exit{
      animation: overlayOut 650ms ease-in forwards;
    }

    /* ---- Keyframes ---- */
    @keyframes overlayIn { from{opacity:0} to{opacity:1} }
    @keyframes overlayOut { to{opacity:0; visibility:hidden} }

    @keyframes floorIn { to{opacity:1; transform: translateY(0)} }

    @keyframes boxIntro {
      from { opacity:0; transform: translateY(34px) scale(0.84); }
      to   { opacity:1; transform: translateY(22px) scale(1); }
    }

    @keyframes boxShake {
      0%   { transform: translateY(22px) rotate(0deg); }
      10%  { transform: translateY(22px) rotate(-2deg); }
      20%  { transform: translateY(22px) rotate(2deg); }
      32%  { transform: translateY(22px) rotate(-2.6deg); }
      44%  { transform: translateY(22px) rotate(2.6deg); }
      60%  { transform: translateY(22px) rotate(-1.2deg); }
      76%  { transform: translateY(22px) rotate(1.2deg); }
      100% { transform: translateY(22px) rotate(0deg); }
    }

    /* Slower lid */
    @keyframes lidPop {
      0%   { transform: translateX(-50%) translateY(0) rotate(0deg); }
      25%  { transform: translateX(-50%) translateY(-10px) rotate(-6deg); }
      55%  { transform: translateX(-50%) translateY(-36px) rotate(-18deg); }
      100% { transform: translateX(-50%) translateY(-62px) rotate(-30deg); }
    }

    @keyframes sparkBurst{
      0% { opacity:0; transform: translateX(-50%) scale(0.6); }
      40%{ opacity:1; transform: translateX(-50%) scale(3.4); }
      100%{ opacity:0; transform: translateX(-50%) scale(6.0); }
    }

    @keyframes bottleLaunch{
      0% { opacity:0; transform: translateX(-50%) translateY(58px) scale(0.65) rotate(0deg); }
      18%{ opacity:1; transform: translateX(-50%) translateY(18px) scale(0.95) rotate(-6deg); }
      60%{ opacity:1; transform: translateX(-50%) translateY(-150px) scale(1.05) rotate(6deg); }
      100%{ opacity:1; transform: translateX(-50%) translateY(-205px) scale(1.0) rotate(0deg); }
    }

    @keyframes floatBurst1{
      0% { opacity:0; transform: translateX(-50%) translate(-10px, 70px) scale(.55) rotate(0deg); }
      18%{ opacity:1; transform: translateX(-50%) translate(-130px, 10px) scale(.95) rotate(-18deg); }
      70%{ opacity:1; transform: translateX(-50%) translate(-190px, -150px) scale(1.05) rotate(-38deg); }
      100%{ opacity:0; transform: translateX(-50%) translate(-210px, -240px) scale(1.08) rotate(-56deg); }
    }
    @keyframes floatBurst2{
      0% { opacity:0; transform: translateX(-50%) translate(10px, 70px) scale(.55) rotate(0deg); }
      18%{ opacity:1; transform: translateX(-50%) translate(130px, 12px) scale(.95) rotate(14deg); }
      70%{ opacity:1; transform: translateX(-50%) translate(190px, -145px) scale(1.06) rotate(32deg); }
      100%{ opacity:0; transform: translateX(-50%) translate(215px, -245px) scale(1.1) rotate(46deg); }
    }
    @keyframes floatBurst3{
      0% { opacity:0; transform: translateX(-50%) translate(0px, 70px) scale(.55) rotate(0deg); }
      22%{ opacity:1; transform: translateX(-50%) translate(0px, 10px) scale(.95) rotate(8deg); }
      75%{ opacity:1; transform: translateX(-50%) translate(0px, -170px) scale(1.08) rotate(18deg); }
      100%{ opacity:0; transform: translateX(-50%) translate(0px, -260px) scale(1.12) rotate(24deg); }
    }

    @keyframes petalBurst1{
      0% { opacity:0; transform: translateX(-50%) translate(-10px, 78px) scale(.55) rotate(0deg); }
      22%{ opacity:1; transform: translateX(-50%) translate(-160px, 22px) scale(.95) rotate(-100deg); }
      78%{ opacity:1; transform: translateX(-50%) translate(-215px, -118px) scale(1.05) rotate(-180deg); }
      100%{ opacity:0; transform: translateX(-50%) translate(-245px, -210px) scale(1.1) rotate(-240deg); }
    }
    @keyframes petalBurst2{
      0% { opacity:0; transform: translateX(-50%) translate(10px, 78px) scale(.55) rotate(0deg); }
      22%{ opacity:1; transform: translateX(-50%) translate(160px, 22px) scale(.95) rotate(100deg); }
      78%{ opacity:1; transform: translateX(-50%) translate(220px, -115px) scale(1.05) rotate(180deg); }
      100%{ opacity:0; transform: translateX(-50%) translate(250px, -215px) scale(1.1) rotate(240deg); }
    }
    @keyframes petalBurst3{
      0% { opacity:0; transform: translateX(-50%) translate(0px, 78px) scale(.55) rotate(0deg); }
      26%{ opacity:1; transform: translateX(-50%) translate(0px, 20px) scale(.95) rotate(150deg); }
      80%{ opacity:1; transform: translateX(-50%) translate(0px, -120px) scale(1.08) rotate(260deg); }
      100%{ opacity:0; transform: translateX(-50%) translate(0px, -220px) scale(1.12) rotate(330deg); }
    }

    @keyframes titleIn{ to { opacity:1; transform: translateX(-50%) translateY(0); } }
    @keyframes subtitleIn{ to { opacity:1; transform: translateX(-50%) translateY(0); } }
    @keyframes titlePulse{
      0%,100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.03); }
    }

    @media (max-width: 480px){
      .bottle{ width: 84px; }
      .heart{ width: 48px; }
      .petal{ width: 56px; }
      .boxWrap{ width:190px; height:190px; }
      .boxBody{ width:190px; }
      .boxLid{ width:212px; }
      .title{ white-space: normal; text-align:center; }
      .subtitle{ white-space: normal; text-align:center; }
    }
  </style>
</head>
<body>
  <div id="overlay" class="overlay">
    <canvas id="fx"></canvas>

    <div class="stage">
      <div class="floor"></div>

      <div class="boxWrap">
        <div class="boxLid"></div>
        <div class="boxBody"><div class="ribbon"></div></div>
        <div class="spark"></div>

        <img class="item bottle"
             src="https://assets.laloo.gr/img/cms/bottle.png"
             alt="Laloo Product" />

        <img class="item heart h1"
             src="https://assets.laloo.gr/img/cms/heart_1.png" alt="" />
        <img class="item heart h2"
             src="https://assets.laloo.gr/img/cms/heart_1.png" alt="" />
        <img class="item heart h3"
             src="https://assets.laloo.gr/img/cms/heart_1.png" alt="" />

        <img class="item petal p1"
             src="https://assets.laloo.gr/img/cms/rose%20petal_1.png" alt="" />
        <img class="item petal p2"
             src="https://assets.laloo.gr/img/cms/rose%20petal_1.png" alt="" />
        <img class="item petal p3"
             src="https://assets.laloo.gr/img/cms/rose%20petal_1.png" alt="" />
      </div>

      <div class="title">LALOO BIRTHDAY SALES</div>
      <div class="subtitle">14 years of color</div>
    </div>
  </div>

  <script>
    // ====== Duration (10s) ======
    const DEFAULT_DURATION_MS = 10000;
    const EXIT_MS = 650;
    const overlay = document.getElementById("overlay");

    const qs = new URLSearchParams(location.search);
    const dur = Number(qs.get("duration"));
    const duration = Number.isFinite(dur) && dur >= 2000 && dur <= 20000 ? dur : DEFAULT_DURATION_MS;

    // ====== Fireworks particles (Canvas) ======
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d");

    function resize(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    window.addEventListener("resize", resize);
    resize();

    const particles = [];
    const now = () => performance.now();

    function burst(x, y, power){
      const count = Math.floor(40 + power * 30); // strong
      for(let i=0;i<count;i++){
        const a = Math.random() * Math.PI * 2;
        const sp = (1.2 + Math.random() * 2.8) * power;
        particles.push({
          x, y,
          vx: Math.cos(a) * sp * 120,
          vy: Math.sin(a) * sp * 120 - (80 * power),
          life: 900 + Math.random() * 900,
          born: now(),
          size: 1 + Math.random() * 2.2,
          // keep it classy: white/pink/red range
          hue: 340 + Math.random() * 25,
          sat: 85 + Math.random() * 10,
          lum: 60 + Math.random() * 15
        });
      }
    }

    // Timed bursts: after the lid starts opening, then a few more
    const start = now();
    const schedule = [
      { t: 2300, n: 1, power: 1.05 },
      { t: 3200, n: 2, power: 0.95 },
      { t: 5200, n: 2, power: 1.0 },
      { t: 7400, n: 2, power: 0.9 },
      { t: 9000, n: 1, power: 0.85 },
    ];
    let schIdx = 0;

    function tick(){
      const t = now() - start;

      // Fireworks schedule
      while (schIdx < schedule.length && t >= schedule[schIdx].t){
        for(let i=0;i<schedule[schIdx].n;i++){
          const x = window.innerWidth * (0.25 + Math.random() * 0.5);
          const y = window.innerHeight * (0.18 + Math.random() * 0.25);
          burst(x, y, schedule[schIdx].power);
        }
        schIdx++;
      }

      ctx.clearRect(0,0,window.innerWidth, window.innerHeight);

      // Draw particles
      for(let i=particles.length-1; i>=0; i--){
        const p = particles[i];
        const age = now() - p.born;
        const k = age / p.life;

        if (k >= 1){
          particles.splice(i,1);
          continue;
        }

        // physics
        const dt = 16/1000;
        p.vy += 520 * dt; // gravity
        p.x += p.vx * dt;
        p.y += p.vy * dt;

        // fade + small trail
        const alpha = (1 - k) * 0.9;
        ctx.beginPath();
        ctx.fillStyle = `hsla(${p.hue}, ${p.sat}%, ${p.lum}%, ${alpha})`;
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
      }

      // stop anim a bit after duration to save CPU
      if (t < duration + 900) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    // ====== Exit sequence ======
    setTimeout(() => {
      overlay.classList.add("exit");
      try { window.parent.postMessage({ type: "BIRTHDAY_LOADER_DONE" }, "*"); } catch (e) {}
      setTimeout(() => overlay.remove(), EXIT_MS + 30);
    }, duration);
  </script>
</body>
</html>
